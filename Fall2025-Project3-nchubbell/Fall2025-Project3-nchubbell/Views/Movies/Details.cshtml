@model Fall2025_Project3_nchubbell.Models.ViewModels.MovieDetailsViewModel
@using System

@{
    ViewData["Title"] = "Details";
}

<h1>@Model.Title</h1>

<div>
    <h4>Movie</h4>
    <hr />
    <dl class="row">

        <dt class="col-sm-2">
            Title
        </dt>
        <dd class="col-sm-10">
            @Model.Title
        </dd>

        <dt class="col-sm-2">
            Genre
        </dt>
        <dd class="col-sm-10">
            @Model.Genre
        </dd>

        <dt class="col-sm-2">
            Year
        </dt>
        <dd class="col-sm-10">
            @Model.Year
        </dd>

        <dt class="col-sm-2">
            IMDb
        </dt>
        <dd class="col-sm-10">
            @if (!string.IsNullOrEmpty(Model.ImdbUrl))
            {
                <a href="@Model.ImdbUrl" target="_blank" rel="noopener noreferrer">
                    @Model.ImdbUrl
                </a>
            }
            else
            {
                <span>No IMDb link provided.</span>
            }
        </dd>

        <dt class="col-sm-2">
            Poster
        </dt>
        <dd class="col-sm-10">
            @if (Model.Poster != null)
            {
                var base64 = Convert.ToBase64String(Model.Poster);
                var imgSrc = $"data:image/png;base64,{base64}";
                <img src="@imgSrc" alt="Movie poster" class="img-fluid" />
            }
            else
            {
                <span>No poster available.</span>
            }
        </dd>

    </dl>
</div>

<hr />

<h4>Cast</h4>
@if (Model.Actors != null && Model.Actors.Any())
{
    <ul>
        @foreach (var actor in Model.Actors)
        {
            <li>
                <a asp-controller="Actors"
                   asp-action="Details"
                   asp-route-id="@actor.Id">
                    @actor.Name
                </a>
            </li>
        }
    </ul>
}
else
{
    <p>No actors linked to this movie.</p>
}

<hr />

<h3>AI-Generated Reviews &amp; Sentiment</h3>

@if (Model.Reviews != null && Model.Reviews.Any())
{
    <!-- Overall sentiment heading -->
    <h5>
        Overall Sentiment:
        <strong>@Model.OverallSentimentLabel</strong>
        (@Model.OverallCompoundSentiment.ToString("0.000"))
    </h5>

    <!-- Table with two columns: Review + Sentiment -->
    <table class="table table-striped mt-3">
        <thead>
            <tr>
                <th>Review</th>
                <th>Sentiment</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var review in Model.Reviews)
            {
                string sentimentClass =
                review.Label == "Positive" ? "text-success" :
                review.Label == "Negative" ? "text-danger" :
                "text-muted";

                <tr>
                    <td>
                        @review.Text
                    </td>
                    <td class="@sentimentClass">
                        <strong>@review.Label</strong>
                        <span class="d-block">
                            (compound: @review.Compound.ToString("0.000"))
                        </span>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>No AI reviews available.</p>
}

<hr />

<div>
    <a asp-action="Edit" asp-route-id="@Model.Id">Edit</a> |
    <a asp-action="Index">Back to List</a>
</div>
